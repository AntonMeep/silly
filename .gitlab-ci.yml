image: docker:stable

services:
- docker:dind

dmd: &test
  variables:
    COMPILER: dmd
  stage: build
  script: docker run -v$(pwd):/source ohboi/mini$COMPILER ./test/run.sh

ldc:
  <<: *test
  variables:
    COMPILER: ldc

pages:
  image: node
  script: cd pages && yarn install && yarn build --mode=production && cp -r public ../public
  artifacts:
    paths:
      - public/
  # only:
  #   - /^v\d+\.\d+\.\d+.*$/
  # except:
  #   - branches